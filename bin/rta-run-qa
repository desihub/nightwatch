#!/usr/bin/env python

import os, sys, glob
import argparse

import fitsio

parser = argparse.ArgumentParser(usage = "{prog} [options]")
parser.add_argument("-i", "--indir", type=str,  help="input data directory", required=True)
parser.add_argument("-o", "--outdir", type=str,  help="output directory")
# parser.add_argument("-v", "--verbose", action="store_true", help="some flag")

args = parser.parse_args()

assert os.path.isdir(args.indir)

if (args.outdir is not None) and (not os.path.isdir(args.outdir)):
    os.makedirs(args.outdir)

import rta.qa
qarunner = rta.qa.QARunner()
qadata = qarunner.run(args.indir, args.outdir)

filename = glob.glob(args.indir+'/preproc*.fits')[0]
header = fitsio.read_header(filename, 0)

import rta.plots.amp
rta.plots.amp.write_amp_qa_html(qadata['PER_AMP'],
    '{}/qaAmp-{:08d}.html'.format(args.outdir, header['EXPID']),
    header)


